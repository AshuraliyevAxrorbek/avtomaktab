<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
    <title>Avto Maktab ‚Äî Mobil (Liquid Glass)</title>
    <meta name="theme-color" content="#0b2a6f" />
    <style>
        /* -----------------------------------------------------
            Mobil-only dizayn + iOS-style "Liquid Glass" effekti
        ----------------------------------------------------- */
        :root{
            --brand:#0b2a6f;        
            --brand-600:#0f3a95;
            --brand-700:#082258;
            --text:#e2e8f0;         /* Dark mode default */
            --muted:#94a3b8;        
            --bg:#0a0f1d;           
            --card:rgba(255,255,255,.14); 
            --glass-border:rgba(255,255,255,.25);
            --ring:#3b82f6;
            --success:#10b981;
            --danger:#ef4444;
            --warning:#f59e0b;
            --radius:20px;
            --shadow: 0 20px 60px rgba(0,0,0,.35);
            --active-nav-color: #3b82f6; 
        }
        :root.light{
            --text:#0f172a;
            --muted:#475569;
            --bg:#f7f9ff;
            --card:rgba(255,255,255,.6);
            --glass-border:rgba(148,163,184,.35);
            --shadow: 0 20px 60px rgba(2,6,23,.10);
            --active-nav-color: #0b2a6f;
        }

        /* Asosiy va Umumiy Stillar */
        *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        html,body{height:100%;}
        body{
            margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, Noto Sans;
            background: var(--bg);
            color:var(--text);
            overflow-x:hidden;
            transition: background-color .4s, color .4s;
        }

        /* Mobil-only guard */
        #desktopBlock{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0b1220;color:#fff;z-index:9999;padding:24px;text-align:center}
        @media (min-width:641px){ #desktopBlock{display:flex} }

        /* Safe area + viewport narrow container */
        .app{position:relative;min-height:100svh;display:flex;flex-direction:column;align-items:center;overflow:hidden;}
        .phone{width:100%;max-width:430px;margin-inline:auto; padding: env(safe-area-inset-top) 14px 100px; position: relative;}

        /* Liquid background */
        .liquid{position:fixed;inset:0;overflow:hidden;z-index:-1}
        .blob{position:absolute;filter:blur(50px);opacity:.45;border-radius:50%}
        .b1{width:420px;height:420px;left:-120px;top:-120px;background:radial-gradient(circle at 30% 30%, #1747c9, transparent 60%);animation:float 12s ease-in-out infinite}
        .b2{width:520px;height:520px;right:-160px;top:20%;background:radial-gradient(circle at 70% 60%, #0b2a6f, transparent 60%);animation:float2 16s ease-in-out infinite}
        .b3{width:480px;height:480px;left:-140px;bottom:-160px;background:radial-gradient(circle at 50% 50%, #2a6fff, transparent 60%);opacity:.35;animation:float3 18s ease-in-out infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(20px)}}
        @keyframes float2{0%,100%{transform:translate(0,0)}50%{transform:translate(-12px,12px)}}
        @keyframes float3{0%,100%{transform:translate(0,0)}50%{transform:translate(16px,-10px)}}

        /* Nav (Dynamic Island uslubida) */
        .nav{position:sticky;top:0;z-index:50;margin:10px auto 8px;display:flex;gap:10px;align-items:center;justify-content:space-between;backdrop-filter:saturate(130%) blur(16px);-webkit-backdrop-filter:saturate(130%) blur(16px); background:var(--card); border:1px solid var(--glass-border); border-radius:18px; padding:10px 12px; box-shadow: var(--shadow)}
        .brand{display:flex;align-items:center;gap:10px}
        .badge{display:grid;place-items:center;width:40px;height:40px;border-radius:14px;background:linear-gradient(135deg,#2048a9 0%,var(--brand) 100%);color:#fff;box-shadow:inset 0 1px 0 rgba(255,255,255,.15)}
        .title{font-weight:900;font-size:16px;line-height:1}
        .subtitle{font-size:11px;color:var(--muted)}
        .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.14);border:1px solid var(--glass-border);font-size:11px}
        
        /* Tema o'zgartirish tugmasi CSS */
        .switch-container {display: flex; align-items: center;}
        .switch {
            position: relative;
            display: flex;
            align-items: center;
            padding: 2px;
            background: rgba(255,255,255,.14);
            border: 1px solid var(--glass-border);
            border-radius: 999px;
            width: 80px;
            height: 36px;
        }
        .switch button {
            background: none;
            border: none;
            color: var(--text);
            width: 50%;
            height: 32px;
            display: grid;
            place-items: center;
            z-index: 1;
            cursor: pointer;
            transition: color .4s;
        }
        .switch button:hover { opacity: .8; }
        .switch .dot {
            position: absolute;
            left: 2px;
            width: 36px;
            height: 32px;
            background: var(--brand); 
            border-radius: 999px;
            box-shadow: 0 2px 8px rgba(0,0,0,.2);
            transition: transform .3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        :root.light .switch .dot {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,.15);
        }
        :root.light .switch button { color: var(--text); }
        .switch button:first-child { color: var(--muted); }
        :root.light .switch button:last-child { color: var(--muted); }

        /* Cards & Buttons */
        .card{position:relative;background:var(--card);border:1px solid var(--glass-border);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:saturate(140%) blur(18px);-webkit-backdrop-filter:saturate(140%) blur(18px);overflow:hidden; transition: background-color .4s, border-color .4s}
        .card::before{content:"";position:absolute;inset:0;border-radius:inherit;background:radial-gradient(120% 120% at 0% 0%, rgba(255,255,255,.25), transparent 60%), radial-gradient(90% 90% at 100% 0%, rgba(255,255,255,.2), transparent 60%), radial-gradient(120% 120% at 100% 100%, rgba(255,255,255,.15), transparent 60%);mix-blend-overlay;opacity:.7;pointer-events:none}
        .card .content{position:relative;z-index:1}
        .p-16{padding:16px}.p-20{padding:20px}.p-24{padding:24px}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:14px;border:1px solid var(--glass-border); background:linear-gradient(135deg,#2048a9 0%,var(--brand) 100%);color:#fff;font-weight:700;box-shadow:0 8px 24px rgba(11,42,111,.35);cursor:pointer;transition:transform .08s ease, filter .2s ease}
        .btn:active{transform:scale(.98)}
        .btn-ghost{background:transparent;color:var(--text); box-shadow: none !important;}
        .btn-ghost:active{background:rgba(255,255,255,.05);}

        /* Savol tanlash tugmalari */
        .choices .choice {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 16px;
            border-radius: 14px;
            border: 1px solid var(--glass-border);
            background: rgba(255,255,255,.08);
            color: var(--text);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: background .15s, border-color .15s, transform .05s;
        }
        .choices .choice:hover { background: rgba(255,255,255,.15); }
        .choices .choice:active { transform: scale(.99); }
        .choices .choice .letter { transition: background .15s; }

        /* Javob holatlari */
        .choices .choice.correct {
            background: rgba(16,185,129,.2); /* Success yashil fon */
            border-color: var(--success);
            color: var(--success);
        }
        .choices .choice.correct .letter {
            background: var(--success);
            color: #fff;
        }
        .choices .choice.wrong {
            background: rgba(239,68,68,.2); /* Danger qizil fon */
            border-color: var(--danger);
            color: var(--danger);
        }
        .choices .choice.wrong .letter {
            background: var(--danger);
            color: #fff;
        }


        /* -----------------------------------------------
            SAHIFALAR O'TISH ANIMATSIYASI (SLIDE EFFECT)
        ----------------------------------------------- */
        .screens-container {
            position: relative;
            width: 100%;
            max-width: 430px;
            margin-inline: auto;

        }
        .screen {
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity .4s ease-in-out, transform .4s ease-in-out;
            padding-bottom: 30px; 
        }
        /* Kirib kelish */
        .screen.active {
            position: relative; 
            opacity: 1;
            pointer-events: auto;
            transform: translateX(0) !important; 
            z-index: 10;
        }
        
        .screen.exit-left {
            opacity: 0;
            transform: translateX(-100%) !important;
            z-index: 5;
            position: absolute !important;
        }
        /* O'ngdan kirib kelish holati */
        .screen:not(.active) {
            transform: translateX(100%);
            position: absolute;
        }

        /* -----------------------------------------------
            PASTKI NAVIGATSIYA BAR
        ----------------------------------------------- */
        .bottom-nav-bar {
            position: fixed; /* Joyida qotib turadi */
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100; /* Boshqa kontent ustida bo'lishi uchun */
            padding-bottom: env(safe-area-inset-bottom);
        }
        .bottom-nav-inner {
            padding: 0 14px;
            max-width: 430px;
            margin-inline: auto;
        }
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 12px;
            background: var(--card); 
            border-top: 1px solid var(--glass-border);
            backdrop-filter: blur(20px) saturate(140%);
            -webkit-backdrop-filter: blur(20px) saturate(140%);
            border-radius: 20px 20px 0 0; 
            box-shadow: 0 -10px 30px rgba(0,0,0,.15);
        }
        .bottom-nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--muted);
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            transition: color .2s, background .2s;
        }
        .bottom-nav a svg {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
            transition: stroke .2s;
        }
        .bottom-nav a.active {
            color: var(--active-nav-color);
        }
        .bottom-nav a.active svg {
            stroke: var(--active-nav-color);
        }
        .bottom-nav a:not(.active):hover {
            background: rgba(255,255,255,.05);
            color: var(--text);
        }
        
        /* O'rganish sahifasi uchun qo'shimcha stil */
        .study-section {
            margin-bottom: 20px;
            border-radius: 16px;
            padding: 20px;
            background: rgba(255,255,255,.08);
            border: 1px solid rgba(255,255,255,.1);
        }
        .study-section h3 {
            margin-top: 0;
            border-left: 4px solid var(--ring);
            padding-left: 10px;
        }
        .study-section ul {
            list-style: none;
            padding-left: 0;
            margin-top: 10px;
        }
        .study-section li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            font-size: 14px;
            line-height: 1.5;
        }
        .study-section li::before {
            content: '‚Ä¢';
            color: var(--ring);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
            position: absolute;
            left: 0;
        }

        .hidden{ display:none !important; }


        /* ‚úÖ Bosish faqat buttonning o‚Äòzida ishlashi uchun */
        .choices .choice * { pointer-events:none; }
        .choices .choice { pointer-events:auto; }


        #timerBox {
            animation: pulse 1.8s infinite ease-in-out;
        }

        @keyframes pulse {
            0%,100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }


    </style>
</head>
<body>
    <div id="desktopBlock"><div class="box">
        <h2 style="margin:0 0 8px">Bu ilova mobil format uchun</h2>
        <p style="opacity:.8">Iltimos, ilovani smartfoningizda oching. Hozircha desktop rejimi qo‚Äòllab-quvvatlanmaydi.</p>
    </div></div>

    <div class="liquid" aria-hidden="true">
        <div class="blob b1"></div>
        <div class="blob b2"></div>
        <div class="blob b3"></div>
    </div>

    <div class="app">
        <div class="phone">
            <div class="nav">
                <div class="brand">
                    <div class="badge"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 13l2-5a3 3 0 0 1 2.8-2h8.4a3 3 0 0 1 2.8 2l2 5"/><rect x="2" y="13" width="20" height="6" rx="2"/><circle cx="7" cy="17" r="1.5"/><circle cx="17" cy="17" r="1.5"/></svg></div>
                    <div>
                        <div class="title">Avto Maktab</div>
                        <div class="subtitle">Avtonarx Bot ‚Äî WebApp</div>
                    </div>
                </div>
                <div class="switch-container">
                    <div class="switch" aria-label="Tun/Tong">
                        <button id="lightBtn" title="Tong"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M2 12h2m16 0h2m-3.6-6.4l-1.4 1.4M6.4 17.6l-1.4 1.4m0-12.8 1.4 1.4m12.8 12.8-1.4-1.4"/></svg></button>
                        <span class="dot" id="themeDot" aria-hidden="true"></span>
                        <button id="darkBtn" title="Tun"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button>
                    </div>
                </div>
            </div>
            
            <div class="screens-container">
                <section id="start-screen" class="card p-24 screen active" data-index="0">
                    <div class="content">
                        <div class="chip" style="margin-bottom:8px">Imtihon rejimi</div>
                        <h1 class="title-lg">Haydovchilik <span style="color:#2a6fff">Nazariy</span> Imtihoni</h1>
                        <p class="muted" style="font-size:14px">Tayyorlanish uchun testni boshlang. Barcha natijalar "Hisobim" da saqlanadi. üöó</p>
                        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:14px">
                            <button id="startBtn" class="btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5 3l14 9-14 9V3z"/></svg> Testni Boshlash</button>
                            <button id="goToHistoryBtn" class="btn btn-ghost"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/><path d="M12 6v6h4"/></svg> Oxirgi natija</button>
                        </div>
                        <div id="lastResultSummary" class="card p-16" style="margin-top:20px; border-radius:14px; display:none">
                            <h4 style="margin:0 0 4px; color:var(--ring)">So'nggi test</h4>
                            <p id="summaryText" class="muted" style="font-size:13px"></p>
                        </div>
                    </div>
                </section>

                <section id="quiz-screen" class="screen" data-index="1" aria-live="polite">
                    <div class="card p-16">
                        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">

                            <div id="quizStatusChip" class="chip">
                                Savol <span id="qIndex">1</span>/<span id="qTotal">20</span>
                            </div>

                            <!-- ‚úÖ Yangi TIMER CHIP qo‚Äòshildi -->
                            <div class="chip" id="timerBox" style="background:rgba(42,111,255,.14); display:flex; align-items:center; gap:6px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                                <span id="timer">30:00</span>
                            </div>
                            <!-- ‚úÖ Timer chip tugadi -->

                            <div class="chip" style="background:rgba(239,68,68,.14)">
                                Xato: <span id="mistakes">0</span> / 3
                            </div>

                        </div>

                        <div class="progress" style="margin-top:10px; height:10px; background:rgba(255,255,255,.14); border:1px solid var(--glass-border); border-radius:999px; overflow:hidden">
                            <span id="bar" style="display:block;height:100%;width:0%;background:linear-gradient(90deg,#2a6fff,#0b2a6f);transition:width .4s ease"></span>
                        </div>
                    </div>

                    <div class="card p-24" style="margin-top:10px">
                        <h2 id="qText" style="font-size:20px;margin:0 0 12px"></h2>
                        <div id="choices" class="choices" style="display:grid;gap:10px"></div>
                        <div id="rationale" class="rationale muted" style="margin-top:12px;display:none; border:1px dashed var(--glass-border);padding:12px;border-radius:12px;font-size:14px;background:rgba(255,255,255,.05)"></div>
                    </div>
                    
                    <div class="footerBar" style="position:sticky;bottom:0;z-index:20;margin:10px auto 0;display:flex;gap:10px;align-items:center;justify-content:space-between;backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);background:var(--card);border:1px solid var(--glass-border);border-radius:16px;padding:10px 12px;box-shadow: var(--shadow)">
                        <button id="restartMid" class="btn btn-ghost">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12a9 9 0 1 1-2.64-6.36"/><path d="M21 3v6h-6"/>
                            </svg>
                            Qayta boshlash
                        </button>
                        <div class="muted" style="font-size:12px">Tanlang va avtomatik o'ting</div>
                    </div>
                </section>


                <section id="finish-screen" class="screen" data-index="2">
                    <div class="card p-24">
                        <div class="chip" style="margin-bottom:8px">Test yakunlandi</div>
                        <div id="finishStatus" class="chip" style="font-weight:700"></div>
                        <h3 id="score" style="font-size:24px;margin:10px 0 6px"></h3>
                        <p class="muted" id="finishText" style="font-size:14px"></p>
                        <p style="margin-top:15px; font-size:14px;">
                            <b style="color:var(--ring)">Izoh va chuqur bilimlar</b> uchun har kuni test ishlab izohini olib o'rganib olsangiz bo'ladi! üëá
                        </p>
                        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
                            <a href="https://t.me/avtoelon_avtobozor" target="_blank" class="btn" style="background: linear-gradient(135deg, #0088cc 0%, #00a4ff 100%); border-color: #007bb6;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 5L2 12l8 4 5 5 7-17z"/><path d="M10 16l4-4"/></svg> Telegram Kanal
                            </a>
                            <button id="restart" class="btn btn-ghost"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-2.64-6.36"/><path d="M21 3v6h-6"/></svg> Asosiy menyu</button>
                            <button id="goToReview" class="btn btn-ghost"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V10z"/><path d="M14 2v8h8"/></svg> Xatolarimni ko'rish</button>
                        </div>
                    </div>
                    <div id="reviewListContainer" class="card p-24 hidden" style="margin-top:10px; max-height:50svh; overflow:auto">
                        <h4 style="margin:0 0 8px;font-size:16px">Savollarga izohlar</h4>
                        <div id="reviewList" style="display:grid;gap:10px"></div>
                    </div>
                </section>

                
                <section id="account-screen" class="screen" data-index="3">
                    <h1 class="title-lg" style="font-size:24px">üë§ Mening Hisobim</h1>
                    <p class="muted" style="margin-bottom:15px; font-size:14px">Barcha ishlagan testlaringiz arxivi:</p>
                    <div id="historyList" style="display:grid;gap:12px;">
                        <p class="muted" style="text-align:center;">Tarix yuklanmoqda...</p>
                    </div>
                    <button id="clearHistoryBtn" class="btn btn-ghost" style="margin-top:20px; color:var(--danger); border-color:var(--danger); background:rgba(239,68,68,.1); display:block; width:100%;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18m-2 0l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m1 0V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2"/></svg>
                        Barcha Tarixni Tozalash
                    </button>
                </section>
                
                <section id="study-screen" class="screen" data-index="4">
                    <h1 class="title-lg" style="font-size:24px">üìö Yo'l Belgilari va Qoidalar (Super Qisqa Yodlash Usuli)</h1>
                    <p class="muted" style="margin-bottom:20px; font-size:14px">
                        Quyidagi izohlar imtihonda ko‚Äòp beriladigan savollarga asoslangan. Qoidalarning mazmunini tushunish ‚Äî 50% muvaffaqiyat!
                    </p>

                    <!-- 1. Taqiqlovchi belgilar -->
                    <div class="study-section">
                        <h3 style="color:var(--danger)">üî¥ Ta'qiqlovchi Belgilar ‚Äî ‚ÄúQILMA!‚Äù belgilar</h3>
                        <p class="muted">Ko‚Äòpincha <b>qizil doira</b>. Agar doira bo‚Äòlsa ‚Äî demak cheklov yoki taqiq.</p>
                        <ul>
                            <li><b>üö´ Kirish Taqiqlangan (3.1)</b> ‚Äî Oq doira ichida <b>qizil gorizontal chiziq</b>. Faqat maxsus transport (masalan favqulodda) kirishi mumkin.</li>
                            <li><b>‚õî Harakat taqiqlangan</b> ‚Äî Umuman mashina kirishiga ruxsat YO‚ÄòQ.</li>
                            <li><b>üÖø To‚Äòxtash/Turish taqiqlangan</b> ‚Äî <u>Bir chiziq = to‚Äòxtash mumkin emas</u>, <u>Ikki chiziq = umuman turib bo‚Äòlmaydi</u>.</li>
                            <li><b>üö∑ Piyodalar taqiqlangan</b> ‚Äî Faqat transport harakatlanadi.</li>
                            <li><b>60</b> ‚Äî Demak ‚Äú60 dan yuqori bo‚Äòlma‚Äù. Tezlik chegarasi belgisi har doim shu joydan boshlanadi.</li>
                        </ul>
                        ‚úÖ Qoidaga ‚Äúbir jumla bilan‚Äù:  
                        <b>QIZIL DOIRA = TAQIQLASH yoki CHEKLASH!</b>
                    </div>

                    <!-- 2. Ogohlantiruvchi belgilar -->
                    <div class="study-section">
                        <h3 style="color:var(--warning)">‚ö†Ô∏è Ogohlantiruvchi Belgilar ‚Äî ‚ÄúEHTIYOT BO‚ÄòL!‚Äù</h3>
                        <p class="muted">Uchburchak va qizil ramkali bo‚Äòladi. Haydovchini oldinda xavf borligi haqida ogohlantiradi.</p>
                        <ul>
                            <li><b>üö∏ Piyodalar o‚Äòtish joyi</b> ‚Äî To‚Äòxtashga tayyor turing, piyoda ustun.</li>
                            <li><b>üêÑ Yovvoyi hayvonlar</b> ‚Äî Tezlikni tushiring, to‚Äòsatdan chiqishi mumkin.</li>
                            <li><b>üåÄ Tik burilish</b> ‚Äî Rulni tayyor tuting, tezlikni moslang.</li>
                            <li><b>‚¨á Tik tushish</b> ‚Äî Tormoz qizib ketishi mumkin, past tezlik + past uzatma.</li>
                        </ul>
                        ‚úÖ Esda qolarli:
                        <b>UCHBURCHAK = OG‚ÄòOH BO‚ÄòL!</b>
                    </div>

                    <!-- 3. Imtiyoz belgilar -->
                    <div class="study-section">
                        <h3 style="color:var(--success)">‚úÖ Imtiyoz (Ustuvorlik) Belgilari ‚Äî ‚ÄúKIMGA YO‚ÄòL BERAMAN?‚Äù</h3>
                        <p class="muted">Asosan oq-sariq romb yoki teskari uchburchak. Boschqa mashinaga yo‚Äòl berish yoki ustuvorlikni bildiradi.</p>
                        <ul>
                            <li><b>üî∂ ASOSIY YO‚ÄòL</b> ‚Äî Romb belgisi. Demak siz ustuvorsiz.</li>
                            <li><b>üîª YO‚ÄòL BER</b> ‚Äî Teskari uchburchak. To‚Äòliq to‚Äòxtamaslik mumkin, lekin yo‚Äòl berish shart.</li>
                            <li><b>üõë STOP</b> ‚Äî Albatta to‚Äòliq to‚Äòxtash!</li>
                            <li><b>üîÑ Aylanma harakat</b> ‚Äî Ichkarida yurgan mashina ustun.</li>
                        </ul>
                        ‚úÖ Yodlash:
                        <b>ROMB ‚Üí USTUN</b>  
                        <b>TESKARI UCHBURCHAK ‚Üí YO‚ÄòL BER</b>
                    </div>

                    <!-- 4. Axborot belgilar -->
                    <div class="study-section">
                        <h3 style="color:var(--ring)">üîµ Axborot Belgilar ‚Äî ‚ÄúQayerdaman? Nima bor?‚Äù</h3>
                        <p class="muted">Ko‚Äòpincha KO‚ÄòK kvadrat. Bu belgilar yo‚Äòl sharoiti, xizmatlar yoki yo‚Äònalishni ko‚Äòrsatadi.</p>
                        <ul>
                            <li><b>üÖø Parking</b> ‚Äî Ruxsat etilgan to‚Äòxtash joyi.</li>
                            <li><b>‚õΩ Yoqilg‚Äòi shoxobchasi</b> ‚Äî Oldinda benzin/ gaz bor.</li>
                            <li><b>üè• Kasalxona</b> ‚Äî Ovoz signalidan foydalanmang!</li>
                            <li><b>‚Ñπ Axborot punkt</b> ‚Äî Yo‚Äòlovchilar uchun ma‚Äôlumot.</li>
                        </ul>
                    </div>

                    <!-- 5. Qoidalar bo‚Äòyicha mini-maslahatlar -->
                    <div class="study-section">
                        <h3 style="color:var(--brand)">üí° Eng Ko‚Äòp Xato Qilinadigan Qoidalar</h3>
                        <ul>
                            <li><b>‚úÖ Piyodalar o‚Äòtish joyida har doim piyoda ustun.</b></li>
                            <li><b>‚úÖ STOP belgisida to‚Äòliq to‚Äòxtash shart, hatto yo‚Äòl bo‚Äòsh bo‚Äòlsa ham.</b></li>
                            <li><b>‚úÖ Qizil chiroq yonib miltillasa ‚Äî to‚Äòxtab, xavfsiz bo‚Äòlsa o‚Äòtish mumkin.</b></li>
                            <li><b>‚úÖ Uzluksiz chiziqni kesib o‚Äòtish taqiqlangan (jarima + xavf!).</b></li>
                            <li><b>‚úÖ Aylanmada ‚Äî ichkarida yurgan mashina ustun.</b></li>
                        </ul>
                    </div>

                    <!-- 6. Hayotiy misollar -->
                    <div class="study-section">
                        <h3 style="color:var(--danger)">üß† Hayotiy Vaziyatlar</h3>
                        <ul>
                            <li><b>Masalan:</b> Yo‚Äòlda STOP bor, lekin mashina yo‚Äòq ‚Äî baribir to‚Äòxtaysan.</li>
                            <li><b>Masalan:</b> Piyada yugurib chiqmoqchi ‚Äî chiroq yashil bo‚Äòlsa ham yo‚Äòl beriladi.</li>
                            <li><b>Masalan:</b> Quvib o‚Äòtayapsiz, lekin oldinda piyodalar o‚Äòtish joyi ‚Äî TAQIQLANGAN.</li>
                        </ul>
                    </div>

                    <!-- 7. Mini test -->
                    <div class="study-section">
                        <h3 style="color:var(--success)">üß© Mini-Test (Yodlab qolish uchun)</h3>
                        <ul>
                            <li>Romb shakli ‚Äì nima? ‚Üí <b>Asosiy yo‚Äòl</b></li>
                            <li>STOP ‚Äì nima? ‚Üí <b>To‚Äòliq to‚Äòxtash shart</b></li>
                            <li>Qizil doira ‚Äì nima? ‚Üí <b>Taqiqlovchi</b></li>
                            <li>Aylanmada kim ustun? ‚Üí <b>Ichkarida yurgan</b></li>
                        </ul>
                    </div>
                </section>


                <section id="school-screen" class="screen" data-index="5">
                    <h1 class="title-lg" style="font-size:24px">üè´ Avtomaktablar</h1>
                    <p class="muted" style="margin-bottom:15px; font-size:14px">Viloyatlardagi faol avtomaktablar ro'yxati (Joylashuv + Kontakt):</p>

                    <div id="schoolList" style="display:grid;gap:12px;">

                        <!-- Toshkent -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Toshkent (Chilonzor)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Chilonzor, 10-kvartal | Tel: +998 71 123 45 67</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Chilonzor+10-kvartal')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Toshkent (Yakkasaroy)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Bobur ko‚Äòchasi, 45-uy | Tel: +998 90 555 22 06</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Bobur+ko%27chasi+45')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Samarqand -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Samarqand (Registon)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Registon ko'chasi, 5-uy | Tel: +998 66 789 01 23</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Registon+ko%27chasi+5')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Samarqand (Siab bozori)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Siab, Amir Temur ko‚Äòchasi 12 | Tel: +998 99 444 88 33</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Siab+bozori')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Andijon -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Andijon (Markaz)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Musayev ko'chasi, 20-uy | Tel: +998 74 228 18 00</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Musayev+ko%27chasi+20,+Andijon')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Andijon (Bobur shoh)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Bobur shoh ko‚Äòchasi, 71-uy | Tel: +998 91 607 43 39</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Bobur+shoh+71,+Andijon')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Farg'ona -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Farg‚Äòona (Vodiy markazi)</h4>
                            <p class="muted" style="font-size:13px">Manzil: A. Farg‚Äòoniy ko‚Äòchasi, 120-uy | Tel: +998 90 123 00 77</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Al+Fargoni+120,+Fargona')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Farg‚Äòona (Marg‚Äòilon)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Marg‚Äòilon sh., Sayid Ahmad ko‚Äòchasi | Tel: +998 93 505 77 44</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Margilon+Sayid+Ahmad')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Namangan -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Namangan (Davlatobod)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Davlatobod tumani, O‚Äòzbekiston ko‚Äòchasi | Tel: +998 97 111 22 44</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Uzbekistan+ko%27chasi,+Namangan')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Namangan (Chortoq)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Chortoq tumani, Mustaqillik ko‚Äòchasi | Tel: +998 93 002 56 70</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Chortoq,+Namangan')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Buxoro -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Buxoro (Markaz)</h4>
                            <p class="muted" style="font-size:13px">Manzil: M. Iqbol ko‚Äòchasi, 45-uy | Tel: +998 98 274 51 00</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=M+Iqbol+45,+Buxoro')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Buxoro (G‚Äòijduvon)</h4>
                            <p class="muted" style="font-size:13px">Manzil: G‚Äòijduvon tumani, Istiqlol ko‚Äòchasi | Tel: +998 90 672 88 99</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Gijduvon,+Buxoro')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Qarshi (Qashqadaryo) -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Qarshi (Markaz)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Shota Rustaveli ko‚Äòchasi | Tel: +998 97 770 01 10</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Shota+Rustaveli+Qarshi')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Qarshi (Koson)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Koson sh., Navbahor ko‚Äòchasi | Tel: +998 94 222 77 66</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Koson+Navbahor')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Surxondaryo -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Termiz (Surxondaryo)</h4>
                            <p class="muted" style="font-size:13px">Manzil: At-Termiziy ko‚Äòchasi | Tel: +998 91 503 44 44</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Termiz+At-Termiziy')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Sho‚Äòrchi (Surxon)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Sho‚Äòrchi tumani, Bozor ko‚Äòchasi | Tel: +998 93 701 99 55</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Shorchi')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Navoiy -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Navoiy (Markaz)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Galaba ko‚Äòchasi | Tel: +998 90 777 55 44</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Navoiy+Galaba')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Zarafshon (Navoiy)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Zarafshon sh., Amir Temur ko‚Äòchasi | Tel: +998 93 000 88 22</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Zarafshon')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Xorazm -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Xiva (Xorazm)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Polvon darvoza yaqinida | Tel: +998 91 222 66 88</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Xiva')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Urganch (Xorazm)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Urganch sh., Al-Xorazmiy ko‚Äòchasi | Tel: +998 93 990 07 60</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Urganch')">üìç Xaritada ko'rish</button>
                        </div>

                        <!-- Jizzax -->
                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Jizzax (Zomin yo‚Äòli)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Jizzax sh., Zomin yo‚Äòli | Tel: +998 92 311 20 30</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Jizzax+Zomin')">üìç Xaritada ko'rish</button>
                        </div>

                        <div class="school-item card p-16" style="border-radius: 16px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.1);">
                            <h4 style="margin:0 0 4px; color:var(--ring)">Jizzax (Paxtakor)</h4>
                            <p class="muted" style="font-size:13px">Manzil: Paxtakor sh., Yangi yo‚Äòl | Tel: +998 99 230 50 90</p>
                            <button class="btn" style="padding:8px 12px; font-size:13px; margin-top:10px" onclick="window.open('https://maps.google.com/?q=Paxtakor+Jizzax')">üìç Xaritada ko'rish</button>
                        </div>

                    </div>
                </section>

            </div>

                            <section style="
                                margin:28px auto 0;
                                max-width:520px;
                                padding:26px 22px;
                                background:rgba(255,255,255,0.08);
                                border:1px solid rgba(255,255,255,0.18);
                                border-radius:22px;
                                backdrop-filter:blur(14px);
                                -webkit-backdrop-filter:blur(14px);
                                box-shadow:0 12px 28px rgba(0,0,0,0.22);
                                text-align:center;
                            ">
                                <h2 style="
                                    margin:0;
                                    font-weight:600;
                                    font-size:20px;
                                    color:var(--ring);
                                    letter-spacing:0.3px;
                                ">
                                    Avto Bozor & Testlar
                                </h2>

                                <p style="
                                    margin:10px 0 18px;
                                    font-size:14px;
                                    opacity:0.85;
                                    line-height:1.45;
                                ">
                                    Mashina bozor narxlari, avto yangiliklar va kunlik nazariy testlarni
                                    birinchi bo‚Äòlib oling. Kanaga obuna bo‚Äòling!
                                </p>

                                <button class="btn" style="
                                    width:100%;
                                    padding:12px 18px;
                                    font-size:15px;
                                    font-weight:500;
                                    border-radius:14px;
                                    display:flex;
                                    justify-content:center;
                                    align-items:center;
                                    gap:6px;
                                    box-shadow:0 6px 14px rgba(42,111,255,0.35);
                                " onclick="window.open('https://t.me/avtoelon_avtobozor','_blank')">

                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M22 2L11 13"></path>
                                        <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                                    </svg>

                                    Kanalga kirish
                                </button>
                            </section>
            
            <footer style="padding: env(safe-area-inset-bottom) 0 30px; text-align:center">
                <div class="muted" style="font-size:12px">Savollar: <a href="https://t.me/avtoelon_avtobozor" target="_blank" style="color:var(--ring); text-decoration:none;">@AvtonarxBot</a> | ¬© <span id="year"></span> Avto Maktab</div>
            </footer>
        </div>
    </div>


    
    
    <div class="bottom-nav-bar">
        <div class="phone bottom-nav-inner">
            <nav class="bottom-nav">
                <a href="#start" class="nav-link active" data-target="start-screen" data-index="0">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span>Asosiy</span>
                </a>
                <a href="#study" class="nav-link" data-target="study-screen" data-index="4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
                    <span>O'rganish</span>
                </a>
                <a href="#account" class="nav-link" data-target="account-screen" data-index="3">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Hisobim</span>
                </a>
                <a href="#schools" class="nav-link" data-target="school-screen" data-index="5">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7M5 10v9a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-9"/><path d="M10 22v-4m4 4v-4"/></svg>
                    <span>Maktablar</span>
                </a>
            </nav>
        </div>
    </div>

    <script>
        // --- Globallar va Elementlar ---
        const root = document.documentElement;
        const themeDot = document.getElementById('themeDot');
        const lightBtn = document.getElementById('lightBtn');
        const darkBtn  = document.getElementById('darkBtn');

        const allScreens = document.querySelectorAll('.screen');
        const navLinks = document.querySelectorAll('.nav-link');
        
        const qIndexEl = document.getElementById('qIndex');
        const mistakesEl = document.getElementById('mistakes');
        const barEl = document.getElementById('bar');
        const qTextEl = document.getElementById('qText');
        const choicesEl = document.getElementById('choices');
        const rationaleEl = document.getElementById('rationale');

        const reviewListContainer = document.getElementById('reviewListContainer');
        const reviewList = document.getElementById('reviewList');
        const lastResultSummary = document.getElementById('lastResultSummary');
        const summaryText = document.getElementById('summaryText');

        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        
        let currentActiveScreenId = 'start-screen';
        let currentScreenIndex = 0; 
        
        // --- Imtihon shartlari ---
        const TOTAL_QUESTIONS = 20;
        const PASS_SCORE = 17; // Minimal 17 ta to'g'ri javob kerak
        const MAX_MISTAKES = 3; // Maksimal 3 ta xato

        // Savollar bazasi (Rasmsiz variant)
        const originalQuestions = [
            { id:1, text:"Qaysi belgi transport vositasining 'Asosiy yo'l'da ekanligini bildiradi?", choices:["Uchburchak","Kvadrant","Romb","Sakkizburchak"], correctIndex:2, rationale:"Romb shaklidagi belgi asosiy yo'lni bildiradi.", image: null },
            { id:2, text:"Oq uzluksiz chiziqning ma'nosi?", choices:["Qaytish yo'lagi","Kesib o'tish taqiqlangan bo'luvchi chiziq","Velosiped yo'lagi","Faqat to'xtash joyi"], correctIndex:1, rationale:"Uzluksiz chiziqni kesish va undan o'tish qat'iyan taqiqlanadi. Bu xavfsizlikni ta'minlash uchun qilinadi.", image: null },
            { id:3, text:"Uzoq chiroqlar qachon yaqin chiroqqa almashtirilishi shart?", choices:["Faqat avtobusni ko'rganda","150 metrdan yaqinroqda kelayotgan transport bo'lsa","Piyoda ko'rsangiz","Har doim yomg'irda"], correctIndex:1, rationale:"Qarama-qarshi transportni ko'zlari qamashtirmaslik uchun 150 metrdan yaqinda almashtirilishi kerak.", image: null },
            { id:4, text:"Haydovchi xavfsizlik kamarini taqishi qachon shart?", choices:["Har qanday tezlikda shart","40 km/soat ostida shart emas","Faqat magistralda","Faqat yuk mashinasida"], correctIndex:0, rationale:"Avtomobil harakatlanayotganida har doim taqiladi, bu haydovchining va yo'lovchining xavfsizligini ta'minlaydi.", image: null },
            { id:5, text:"Tirkama tortishda tormoz yo'li qanday o'zgaradi?", choices:["Tormoz yo'li uzayadi","Tormoz yo'li qisqaradi","O'zgarmaydi","Faqat burilish radiusi o'zgaradi"], correctIndex:0, rationale:"Tirkama og'irlikni oshiradi, bu esa inersiya kuchini oshirib, tormoz masofasini uzaytiradi.", image: null },
            { id:6, text:"Kirish taqiqlangan belgisining ko'rinishi qanday?", choices:["Qizil romb","Qizil halqali oq doira","Qora chiziqli sariq uchburchak","Oq doira ichida qizil gorizontal chiziq"], correctIndex:3, rationale:"3.1. 'Kirish taqiqlangan' belgisi oq doira ichidagi qizil gorizontal chiziqdan iborat.", image: null },
            { id:7, text:"Yog'ingarchilikda (yomg'ir/qor) to'xtash masofasi?", choices:["O'zgarmaydi","Qisqaradi","Uzayadi","Faqat old g'ildirak yopishadi"], correctIndex:2, rationale:"Yo'l yuzasi sirpanchiq bo'lgani uchun g'ildiraklar yopishishini yo'qotadi va tormoz masofasi uzayadi.", image: null },
            { id:8, text:"ABS tizimi nima vazifani bajaradi?", choices:["Tezlikni oshiradi","Tormozlashda g'ildirak bloklanishini oldini oladi","Yonilg'i kamaytiradi","Mashina burilishini tezlashtiradi"], correctIndex:1, rationale:"ABS favqulodda tormozlashda g'ildiraklar bloklanishini oldini olib, boshqaruvni saqlaydi.", image: null },
            { id:9, text:"Tartibga solinmagan piyodalar o'tish joyida kim ustuvorlikka ega?", choices:["Avtomobil","Velosipedchi","Piyoda","Avtobus"], correctIndex:2, rationale:"Piyodalar o'tish joyida doimo piyoda ustuvorlikka ega.", image: null },
            { id:10, text:"Haydash paytida mobil telefondan gaplashish mumkinmi?", choices:["Hech qachon","Faqat tunda","Bluetooth/garnitura orqali mumkin","Har doim qo'lda ushlab"], correctIndex:2, rationale:"Qo‚Äòllarsiz rejimda ruxsat beriladi. Qo‚Äòlda ushlab gaplashish taqiqlanadi.", image: null },
            { id:11, text: "Chorrahalarda burilish signali (povorotnik) qachon yoqilishi kerak?", choices: ["Faqat burilish paytida","Manevr boshlashdan oldin","Faqat tunda","Kerak emas"], correctIndex:1, rationale: "Manevr boshlashdan yetarli masofa oldin yoqilishi shart.", image: null },
            { id:12, text: "Yashil svetafor yonib turganida haydovchi qachon to'xtashi kerak?", choices: ["Har doim","Yo'l berish kerak bo'lsa","Chorrahada tirbandlik hosil bo'lsa","Hech qachon"], correctIndex:2, rationale: "Agar chorrahadan o‚Äòtish imkonini to‚Äòsuvchi tirbandlik bo‚Äòlsa, to‚Äòxtash kerak.", image: null },
            { id:13, text: "Avariya sodir bo'lganda birinchi navbatda nima qilish kerak?", choices: ["Sug'urta kompaniyasiga qo'ng'iroq qilish","Avtomobillarni yo'l chetiga olib qo'yish","Avariya ishoralarini o'rnatish va 'avariyka' yoqish","Politsiyani kutish"], correctIndex:2, rationale: "Avvalo xavfsizlik: avariyka yoqiladi va ogohlantiruvchi uchburchak qo'yiladi.", image: null },
            { id:14, text: "Maktab avtobusi to'xtaganida uning yonidan o'tayotgan transport tezligi qanday bo'lishi kerak?", choices: ["70 km/s dan oshmasligi kerak","50 km/s dan oshmasligi kerak","20 km/s dan oshmasligi kerak","Tezlik cheklanmagan"], correctIndex:2, rationale: "Bolalar xavfsizligi uchun keskin sekinlashish talab etiladi.", image: null },
            { id:15, text: "Asosiy yo'l belgisi qanday shaklda bo'ladi?", choices: ["Uchburchak","Oq romb sarg'ish rangda","Ko'k kvadrat","Qizil doira"], correctIndex:1, rationale: "Asosiy yo‚Äòl belgisi sarg‚Äòish fonli oq romb.", image: null },
            { id:16, text: "YSHQ bo'yicha eng yaqin joylashgan to'xtash joyi belgisi qanday rangda bo'ladi?", choices: ["Yashil","Ko'k","Qizil","Sariq"], correctIndex:1, rationale: "Ko‚Äòrsatma beruvchi belgilar odatda ko‚Äòk fonli bo‚Äòladi.", image: null },
            { id:17, text: "Tuman chiroqlari qachon yoqiladi?", choices: ["Faqat tunda","Faqat yomg'irda","Ko‚Äòrinish cheklanganda (tuman/yog‚Äòingarchilik)","Har doim"], correctIndex:2, rationale: "Ko‚Äòrinish yomonlashganda yordamchi yoritish uchun.", image: null },
            { id:18, text: "Haydovchi qachon yo'lovchilarni tushirib/chiqarishi mumkin?", choices: ["Har qanday vaziyatda","Faqat avtomobil to'liq to'xtaganda","Mashina 10 km/soatda yurganda","Agar old eshik bo'lsa"], correctIndex:1, rationale: "Yo‚Äòlovchi amallari faqat to‚Äòliq to‚Äòxtaganda.", image: null },
            { id:19, text: "Tezlikni cheklovchi belgining amal qilish zonasi qayerda tugaydi?", choices: ["Keyingi chorrahada","'Barcha cheklovlar tugashi' belgisi bilan","Aholi punktidan chiqishda","Yuqoridagilar barchasi"], correctIndex:3, rationale: "Cheklov bir nechta holatda bekor qilinishi mumkin.", image: null },
            { id:20, text: "Boshqa transportni quvib o'tish qachon taqiqlanadi?", choices: ["Faqat tunda","Piyodalar o'tish joyida","Asosiy yo'lda bo'lsa","Tezlik 100 km/soat bo'lsa"], correctIndex:1, rationale: "Piyodalar o'tish joyida quvib o‚Äòtish taqiqlanadi.", image: null },

            // 21‚Äî100 yangi savollar
            { id:21, text:"Qaysi transport vositalari yo'nalishli transport vositalari hisoblanadi?", choices:["Yo‚Äònalish va bekatlari belgilangan umum foydalanishdagi (avtobus, trolleybus, tramvay)","Faqat avtobuslar","Istalgan yo‚Äòlovchi tashuvchi avtomobillar","Faqat taksilar"], correctIndex:0, rationale:"Yo‚Äònalishli transport ‚Äî belgilangan yo‚Äònalish/bekatlar bo‚Äòyicha harakatlanadigan jamoat transporti.", image:null },
            { id:22, text:"Asosiy yo‚Äòl ‚Äì", choices:["Tuproqli yo‚Äòlga nisbatan qattiq qoplamali yo‚Äòl","Toshli yo‚Äòlga nisbatan asfalt yo‚Äòl","Ko‚Äòproq bo‚Äòlakli yo‚Äòl","Yuqoridagilardan to‚Äòg‚Äòri ta‚Äôrif keltirilmagan"], correctIndex:0, rationale:"Asosiy yo‚Äòl odatda qattiq qoplamali yoki belgilar bilan asosiy deb belgilangan yo‚Äòl.", image:null },
            { id:23, text:"'To‚Äòxtash taqiqlanadi' belgisi nimani anglatadi?", choices:["Faqat tunda to‚Äòxtash mumkin emas","Hech qachon to‚Äòxtash ham, turib qolish ham mumkin emas","Qisqa muddatga to‚Äòxtash mumkin","Faqat parkingga ruxsat"], correctIndex:1, rationale:"Belgi amalida to‚Äòxtash ham, turib qolish ham taqiqlanadi.", image:null },
            { id:24, text:"Svetafor ishlamayotgan chorrahada ustuvorlik qanday belgilanadi?", choices:["Chapdan kelgan transport ustun","O‚Äòng tomondagi transportga yo‚Äòl beriladi","Hech kim ustun emas","Piyoda ustun"], correctIndex:1, rationale:"'O‚Äòng qo‚Äòl qoidasi' ‚Äî o‚Äòngdan kelganga yo‚Äòl beriladi.", image:null },
            { id:25, text:"'STOP' (To‚Äòxtash) belgisi ko‚Äòrilganda haydovchi nima qiladi?", choices:["Agar mashina bo‚Äòlsa to‚Äòxtaydi","Har doim to‚Äòliq to‚Äòxtaydi","Sekinlashtirib o‚Äòtadi","Signallab o‚Äòtadi"], correctIndex:1, rationale:"STOP belgisida to‚Äòliq to‚Äòxtash majburiy.", image:null },
            { id:26, text:"'Yo‚Äòl ber' (Ustunlik) belgisi nimani talab qiladi?", choices:["To‚Äòxtash","Tezlikni 20 km/soatga tushirish","Asosiy yo‚Äòldagi transportga yo‚Äòl berish","Signal berish"], correctIndex:2, rationale:"Asosiy yo‚Äòlda harakatlanayotganlarga ustunlik beriladi.", image:null },
            { id:27, text:"Uzoq chiroqlarni qachon ishlatish taqiqlanadi?", choices:["Shahar ichida yaxshi yoritilgan ko‚Äòchalarda","Kunduz kuni qish faslida","Yomg‚Äòirda","Yo‚Äòl bo‚Äòsh bo‚Äòlsa"], correctIndex:0, rationale:"Yaxshi yoritilgan joylarda uzoq chiroq ko‚Äòz qamashtiradi.", image:null },
            { id:28, text:"Yo‚Äòl-yo‚Äòlakay transport vositasini yonish xavfi paydo bo‚Äòlsa, avvalo nima qilinadi?", choices:["Suv sepiladi","Akkumulyator uziladi va odamlar xavfsiz joyga olib chiqiladi","Harakat davom ettiriladi","Dvigatelga gaz beriladi"], correctIndex:1, rationale:"Olov xavfida elektr manbai uzilib, odamlar evakuatsiya qilinadi.", image:null },
            { id:29, text:"Avariya uchburchagi qayerga qo‚Äòyiladi?", choices:["Mashina kapotiga","Orqa oynaga yopishtiriladi","Yo‚Äòl yoqasiga me‚Äôyoriy masofada","Old bamper ostiga"], correctIndex:2, rationale:"Orqadan kelayotganlarga ogohlantirish uchun yo‚Äòl yoqasiga qo‚Äòyiladi.", image:null },
            { id:30, text:"Yomg‚Äòirda akvaplanning xavfi nimadan?", choices:["Tormozlarning qizishi","G‚Äòildirakning suv qatlamiga chiqib yo‚Äòl bilan aloqa yo‚Äòqolishi","Dvigatel yong‚Äòin xavfi","Shina bosimi ortishi"], correctIndex:1, rationale:"Suv qatlamida shina yo‚Äòlni 'ushlamaydi', boshqaruv yo‚Äòqolishi mumkin.", image:null },
            { id:31, text:"Qaysi belgi 'Kirish taqiqlanadi' ga teskari ma‚Äôno beradi?", choices:["Harakatlanish taqiqlangan","Yo‚Äòl yopiq","Qizil doira ichida oq chiziq yo‚Äòq","Ikkala tomondan harakatlanish"], correctIndex:3, rationale:"Ikkala tomondan harakatlanish belgisi yo‚Äòlga kirish mumkinligini bildiradi (kiritish emas, balki harakat yo‚Äònalishlari).", image:null },
            { id:32, text:"Velosiped yo‚Äòlkasi bo‚Äòlsa, velosipedchi qayerda harakatlanadi?", choices:["Avtomobil yo‚Äòlagida","Yo‚Äòl chetida","Aynan velosiped yo‚Äòlkasida","Piyodalar yo‚Äòlagida"], correctIndex:2, rationale:"Maxsus yo‚Äòlak mavjud bo‚Äòlsa, undan foydalanish shart.", image:null },
            { id:33, text:"Qachon avariya signali (avariyka) yoqiladi?", choices:["Faqat yomg‚Äòirda","Tirkama tortganda","Majburiy to‚Äòxtashda yoki xavf tug‚Äòilganda","Yo‚Äòl bo‚Äòsh bo‚Äòlsa"], correctIndex:2, rationale:"Xavf tug‚Äòilganda yoki majburiy to‚Äòxtashda boshqalarni ogohlantirish uchun.", image:null },
            { id:34, text:"Temir yo‚Äòl kesishmasida svetofor qizil miltillasa‚Ä¶", choices:["Tezlikni kamaytirib o‚Äòtish mumkin","Piyodalar o‚Äòtishi mumkin","To‚Äòxtash shart","Faqat yuk mashinalari to‚Äòxtaydi"], correctIndex:2, rationale:"Qizil miltillash ‚Äî qat‚Äôiy to‚Äòxtash talabi.", image:null },
            { id:35, text:"Burilishdan oldin orqa ko‚Äòrish oynalarini tekshirishning maqsadi?", choices:["Dizaynni baholash","Orqadan kelayotganlar xavfsizligini ta‚Äôminlash","Yoqilg‚Äòi tejamkorligi","Nisbiy tezlikni o‚Äòlchash"], correctIndex:1, rationale:"Manevr xavfsizligini tekshirish uchun ko‚Äòrinishni nazorat qilish kerak.", image:null },
            { id:36, text:"Tez yordam, yong‚Äòin yoki politsiya sirenali kelayotgan bo‚Äòlsa‚Ä¶", choices:["Tezlikni oshirish","Harakatni to‚Äòxtatmasdan davom etish","Ustuvorlik berish uchun yo‚Äòlni bo‚Äòshatish","Signal berish"], correctIndex:2, rationale:"Favqulodda xizmatlarga ustuvorlik beriladi.", image:null },
            { id:37, text:"'Aylanma harakat' (aylanma chorraha)ga kirishda kim ustun?", choices:["Ichkarida aylanayotgan transport","Kirish chizig‚Äòidagi transport","Piyodalar","Hech kim"], correctIndex:0, rationale:"Aylanmada yurgan transportga yo‚Äòl beriladi.", image:null },
            { id:38, text:"Qaysi holatda tormoz yo‚Äòli eng uzun bo‚Äòladi?", choices:["Quruq asfalt","Nam yo‚Äòl","Muzlagan/sirpanchiq yo‚Äòl","Yangi asfalt"], correctIndex:2, rationale:"Sirpanishda yopishish juda past, tormoz masofasi uzayadi.", image:null },
            { id:39, text:"Oraliq masofani saqlashning umumiy qoidasi?", choices:["1 soniya qoidasi","2 soniya qoidasi","5 soniya qoidasi","Hech qanday qoida yo‚Äòq"], correctIndex:1, rationale:"Kamida 2 soniyalik interval xavfsiz.", image:null },
            { id:40, text:"Olddan qarama-qarshi transport keng o‚Äòtib ketayotgan yo‚Äòlda‚Ä¶", choices:["Markaziy chiziqni bosib o‚Äòtish","O‚Äòng chetga yaqinlashib sekinlashish","Tezlikni oshirish","Signalni uzluksiz bosish"], correctIndex:1, rationale:"Qarama-qarshi harakat xavfsizligi uchun chekka tomon sekinlashiladi.", image:null },
            { id:41, text:"Gibrid/elektro avtomobillarni jimligi nimani anglatadi?", choices:["Hech qanday xavf yo‚Äòq","Piyodalar ularni eshitmasligi mumkin","Tezlik cheklanmaydi","Farqlanmaydi"], correctIndex:1, rationale:"Past tovushli bo‚Äòlgani uchun piyodalar kech sezishi mumkin ‚Äî hushyorlik kerak.", image:null },
            { id:42, text:"Qaysi belgi yo‚Äòlning torayishini bildiradi?", choices:["Uchburchak ichida ikki chiziq yaqinlashgan","Ko‚Äòk kvadrat","Qizil doira","Romb"], correctIndex:0, rationale:"Ogohlantiruvchi uchburchak ichidagi yaqinlashuvchi chiziqlar ‚Äî yo‚Äòl torayishi.", image:null },
            { id:43, text:"Avtomobil orqa tumanga qarshi chiroqlari qachon yoqiladi?", choices:["Har doim","Ko‚Äòrinish juda yomon bo‚Äòlganda","Faqat tunda","Yomg‚Äòir tomchilaganda"], correctIndex:1, rationale:"Kuchli tuman/qor/yomg‚Äòirda orqani ko‚Äòrinishini yaxshilash uchun.", image:null },
            { id:44, text:"Qachon signaldan (gudok) foydalanish mumkin?", choices:["Tungi vaqtda ko‚Äòp foydalanish kerak","Faqat xavfning oldini olish uchun","Har chorrahada","Yo‚Äòl bo‚Äòsh bo‚Äòlsa"], correctIndex:1, rationale:"Signal faqat xavfni ogohlantirish uchun.", image:null },
            { id:45, text:"Qaysi vaziyatda yo‚Äòl chiziqlaridan ustuvorroq hisoblanadi belgilar?", choices:["Hech qachon","Har doim chiziq ustun","Belgilar odatda chiziqlardan ustun","Hech biri ustun emas"], correctIndex:2, rationale:"Tartibda: svetafor > tartibga soluvchi > belgilar > chiziqlar.", image:null },
            { id:46, text:"Tungi haydashda qarama-qarshi chiroqlar qamashtirsa nima qilasiz?", choices:["Ko‚Äòzingizni to‚Äòg‚Äòriga tikasiz","Yo‚Äòlning o‚Äòng chetiga qaraysiz","Tezlikni oshirasiz","Uzoq chiroqni yoqasiz"], correctIndex:1, rationale:"O‚Äòng chetni kuzatib, tezlikni moslab xavfsizlikni saqlang.", image:null },
            { id:47, text:"Shinalardagi to‚Äòg‚Äòri bosimning foydasi?", choices:["Yonilg‚Äòi sarfini oshiradi","Tormoz masofasini uzaytiradi","Boshqaruv va tormozlanishni yaxshilaydi","Ta‚Äôsiri yo‚Äòq"], correctIndex:2, rationale:"To‚Äòg‚Äòri bosim ‚Äî barqarorlik va tormozlanish samarasi.", image:null },
            { id:48, text:"Qachon chapga burilish taqiqlanishi mumkin?", choices:["Ikki tomonlama harakatda","Maxsus taqiqlovchi belgi bo‚Äòlsa","Svetafor yashil bo‚Äòlsa","Yo‚Äòl bo‚Äòsh bo‚Äòlsa"], correctIndex:1, rationale:"Tegishli taqiqlovchi belgi/yo‚Äòl chizig‚Äòi bo‚Äòlsa, burilish taqiqlanadi.", image:null },
            { id:49, text:"Quvib o‚Äòtishdan oldin nimalar tekshiriladi?", choices:["Faqat olddagi mashina masofasi","Yo‚Äòl belgisi, chiziqlar va qarama-qarshi yo‚Äònalish holati","Faqat orqadagi mashina","Faqat tezlik"], correctIndex:1, rationale:"Belgilar/chiziqlar ruxsatini va qarama-qarshi yo‚Äòlni tekshirish shart.", image:null },
            { id:50, text:"Chapga burilganda qarama-qarshi yo‚Äònalishga yo‚Äòl berish qachon kerak?", choices:["Hech qachon","Faqat tunda","Har doim burilishda","Faqat katta chorrahalarda"], correctIndex:2, rationale:"Burilishda qarama-qarshi to‚Äòg‚Äòri kelayotganlarga yo‚Äòl beriladi.", image:null },
            { id:51, text:"Qo‚Äòl tormozi (ruchnoy) qachon ishlatiladi?", choices:["Faqat harakatda","To‚Äòxtash/parkingda avtomobilni tutib turish uchun","Tezlashish uchun","Burilishda"], correctIndex:1, rationale:"Qo‚Äòl tormozi ‚Äî to‚Äòxtagan holatda avtomobilni ushlab turadi.", image:null },
            { id:52, text:"Tayanch nuqtasiz bolani old o‚Äòrindiqda olib ketish‚Ä¶", choices:["Har doim ruxsat","Maxsus bolalar o‚Äòrindiqsiz xavfli","Faqat qisqa masofada ruxsat","Hech qachon muammo emas"], correctIndex:1, rationale:"Bolalar uchun mos o‚Äòrindiq va mahkamlash vositasi kerak.", image:null },
            { id:53, text:"Yoqilg‚Äòi sizib chiqsa‚Ä¶", choices:["Tezda harakatni davom etish","Darhol to‚Äòxtab choralar ko‚Äòrish","Yoqilg‚Äòini arzonlashtirish","Avariya signalini o‚Äòchirib qo‚Äòyish"], correctIndex:1, rationale:"Yong‚Äòin xavfi ‚Äî darhol to‚Äòxtab muammoni bartaraf etish kerak.", image:null },
            { id:54, text:"Qizil chiroq miltillab tursa (svetafor)‚Ä¶", choices:["E‚Äôtibor bermaslik mumkin","To‚Äòxtab, ehtiyotkorlik bilan o‚Äòtish","Yashilga teng","Faqat chapga burilish mumkin"], correctIndex:1, rationale:"Miltillovchi qizil ‚Äî to‚Äòxtab, xavfsiz bo‚Äòlsa o‚Äòtish talab qilinadi (mahalliy qoidalarga bog‚Äòliq, ehtiyotkorlik sharti bilan).", image:null },
            { id:55, text:"Yashil chiroq yonib o‚Äòtganda yo‚Äòl bo‚Äòsh bo‚Äòlmasa‚Ä¶", choices:["Baribir kirish","To‚Äòxtab navbat kutish","Signal berib o‚Äòtish","Yon yo‚Äòlga kirish"], correctIndex:1, rationale:"Chorrahaning ichini to‚Äòsmaslik uchun to‚Äòxtaysiz.", image:null },
            { id:56, text:"Orqa o‚Äòrindiqda o‚Äòtirganlar uchun xavfsizlik kamari‚Ä¶", choices:["Majburiy emas","Faqat uzoq yo‚Äòlda","Majburiy","Faqat bolalarga"], correctIndex:2, rationale:"Barcha o‚Äòrindiqlarda xavfsizlik kamari majburiy.", image:null },
            { id:57, text:"Avtomatik uzatmalar qutisida to‚Äòxtashda tutib turish uchun qaysi rejim?", choices:["D","N","R","P"], correctIndex:3, rationale:"P (Park) ‚Äî to‚Äòxtashda transmissiyani bloklab turadi.", image:null },
            { id:58, text:"Yo‚Äòl chetida to‚Äòxtaganda avval nima qilinadi?", choices:["Darhol eshikni ochish","Avariya signalini yoqish va xavfsiz chetga chiqish","Telefon bilan gaplashish","Dvigatelni gazlash"], correctIndex:1, rationale:"Boshqa ishtirokchilarni ogohlantirish va xavfsizlik birinchi o‚Äòrinda.", image:null },
            { id:59, text:"Qachon sekin harakatlanayotgan transportni quvib o‚Äòtish taqiqlanadi?", choices:["Piyodalar o‚Äòtish joyi oldida/ichida","Yo‚Äòl bo‚Äòsh bo‚Äòlsa","Svetafor yashil bo‚Äòlsa","Tunda"], correctIndex:0, rationale:"Piyodalar o‚Äòtish joylarida quvib o‚Äòtish taqiqlanadi.", image:null },
            { id:60, text:"Yuklarni tashishda nimaga e‚Äôtibor beriladi?", choices:["Faqat og‚Äòirlikka","Mahkamlash, o‚Äòlcham va ko‚Äòrinishga","Faqat rangiga","Faqat egasiga"], correctIndex:1, rationale:"Yuk mahkamligi, o‚Äòlchamning me‚Äôyoriyligi va ko‚Äòrinish talablariga rioya qilinadi.", image:null },
            { id:61, text:"Yo‚Äòl ustuni va to‚Äòsiqlar yaqinida to‚Äòxtash‚Ä¶", choices:["Hech qachon muammo emas","Ko‚Äòrinishni to‚Äòsishi mumkin","Har doim ruxsat","Majburiy"], correctIndex:1, rationale:"Ko‚Äòrinishni to‚Äòsmaslik kerak.", image:null },
            { id:62, text:"'Haydovchi charchog‚Äòi'ning eng xavfli belgisi?", choices:["Ko‚Äòp suv ichish","Ko‚Äòz yumilib ketishi","Telefonni tekshirish","Musiqa balandligi"], correctIndex:1, rationale:"Uxlab qolish xavfi ‚Äî zudlik bilan to‚Äòxtab dam olish kerak.", image:null },
            { id:63, text:"Qor qoplagan yo‚Äòlda harakatlanish uslubi?", choices:["Keskin tormoz/burilish","Yumshoq boshqaruv va oldindan rejalash","Tezlikni doimiy oshirish","Uzoq chiroq"], correctIndex:1, rationale:"Silliq boshqaruv sirpanishni kamaytiradi.", image:null },
            { id:64, text:"Qachon avtotransport yonishiga ko‚Äòproq xavf tug‚Äòiladi?", choices:["Yoqilg‚Äòi sizganda","Yomg‚Äòirda","Qishda","Tuman bo‚Äòlganda"], correctIndex:0, rationale:"Yoqilg‚Äòi sizishi ‚Äî yong‚Äòin xavfi.", image:null },
            { id:65, text:"'Avtomobil yo‚Äòli' belgisining ma‚Äônosi?", choices:["Faqat yuk mashinalari","Faqat avtobuslar","Avtomobillar uchun mo‚Äòljallangan yo‚Äòl qoidalari kuchayadi","Velosipedlar ustun"], correctIndex:2, rationale:"Avtomobil yo‚Äòli ‚Äî maxsus tartib va cheklovlar amal qiladi.", image:null },
            { id:66, text:"Avariya joyida birinchi yordam ko‚Äòrsatishda birinchi qadam?", choices:["Bandaj qo‚Äòyish","Jarohatni suratga olish","Xavfsizlikni ta‚Äôminlash (yo‚Äòlni ogohlantirish)","Hujjat so‚Äòrash"], correctIndex:2, rationale:"Avval o‚Äòzingiz va boshqalarning xavfsizligini ta‚Äôminlash kerak.", image:null },
            { id:67, text:"Svetofor sariq chiroq yonib o‚Äòtganda‚Ä¶", choices:["Tezlikni oshirib o‚Äòting","To‚Äòxtashga tayyorlaning","Hech narsa o‚Äòzgarmaydi","Chapga buriling"], correctIndex:1, rationale:"Sariq ‚Äî ogohlantiruvchi, to‚Äòxtashga tayyorlanish kerak.", image:null },
            { id:68, text:"Avtomobil orqa tumanga qarshi chiroqlarini nojo‚Äòya ishlatish oqibati?", choices:["Hech narsa","Orqadagi haydovchilarni ko‚Äòzini qamashtiradi","Yonilg‚Äòi sarfi oshadi","Dvigatel isiydi"], correctIndex:1, rationale:"Orqadagilarga noqulaylik va xavf tug‚Äòdiradi.", image:null },
            { id:69, text:"Qaysi belgilar ogohlantiruvchi hisoblanadi?", choices:["Ko‚Äòk kvadratlar","Qizil doiralar","Sariq fonli uchburchaklar","Yashil to‚Äòrtburchaklar"], correctIndex:2, rationale:"Ogohlantiruvchi belgilar uchburchak shaklida bo‚Äòladi.", image:null },
            { id:70, text:"Tirkama bilan harakatlanganda burilish‚Ä¶", choices:["Odatdagidan kengroq radiusda bajariladi","Bir xil","Torayadi","Foydasi yo‚Äòq"], correctIndex:0, rationale:"Tirkama sabab burilish radiusi kengayadi.", image:null },
            { id:71, text:"Yo‚Äòl qoplamasida yog‚Äò/yoqilg‚Äòi izi ko‚Äòrsangiz‚Ä¶", choices:["Tezlikni oshirasiz","Keskin tormozlaysiz","Sekinlashtirib ehtiyotkorlik bilan o‚Äòtasiz","Signal berasiz"], correctIndex:2, rationale:"Yopishish pasayadi ‚Äî sekin va silliq boshqaruv kerak.", image:null },
            { id:72, text:"'Piyodalar o‚Äòtish joyi' belgisi nimani bildiradi?", choices:["Piyodalar taqiqlangan","Piyodalar ustunligi bor joy","Faqat velosipedlar","Hech narsa"], correctIndex:1, rationale:"Piyodalar uchun xavfsiz o‚Äòtish joyi, ularga yo‚Äòl berish kerak.", image:null },
            { id:73, text:"Svetafor ishlamay qolgan aylanma chorrahada‚Ä¶", choices:["Ichkaridagiga yo‚Äòl beriladi","Kirishdagiga yo‚Äòl beriladi","Hech kim ustun emas","Piyodalar ustun"], correctIndex:0, rationale:"Aylanmada yurgan transport ustun.", image:null },
            { id:74, text:"'Kirish taqiqlangan' belgisida kimlarga ruxsat bo‚Äòlishi mumkin?", choices:["Hech kimga","Favqulodda xizmatlarga maxsus holatda","Piyodalarga","Velosipedchilarga har doim"], correctIndex:1, rationale:"Favqulodda xizmatlar uchun istisnolar bo‚Äòlishi mumkin (mahalliy qoidalarga muvofiq).", image:null },
            { id:75, text:"Qorong‚Äòida piyodalar ko‚Äòrinishini oshirish uchun‚Ä¶", choices:["Uzoq chiroqni faqat shahar ichida","Faralarni o‚Äòchirib qo‚Äòyish","Toza faralar va oyna, mos nur balandligi","Faqat ichki chiroqlar"], correctIndex:2, rationale:"Ko‚Äòrish-ko‚Äòrinish yaxshi bo‚Äòlsa xavfsizlik oshadi.", image:null },
            { id:76, text:"Avtomobilni tepalikda to‚Äòxtatishda nima muhim?", choices:["Faqat dvigatelni o‚Äòchirish","G‚Äòildiraklarni chetga burish va qo‚Äòl tormozi","Signal berish","Hech narsa"], correctIndex:1, rationale:"Aylanishning oldini olish uchun g‚Äòildirak burilishi va park tormozi kerak.", image:null },
            { id:77, text:"'O‚Äòngga burilish taqiqlangan' belgisida‚Ä¶", choices:["Faqat tunda ruxsat","Hech qachon burilmaslik","Agar yo‚Äòl bo‚Äòsh bo‚Äòlsa burish mumkin","Piyodalar bo‚Äòlsa mumkin"], correctIndex:1, rationale:"Taqiqlovchi belgi ‚Äî burilish taqiqlanadi.", image:null },
            { id:78, text:"Qaysi holatda chapdan quvib o‚Äòtish o‚Äòrniga o‚Äòngdan o‚Äòtishga ruxsat bo‚Äòlishi mumkin?", choices:["Hech qachon","Olddagi transport chapga burilayotganida","Tunda","Svetafor yashil bo‚Äòlsa"], correctIndex:1, rationale:"Olddagi chapga burilsa, o‚Äòngdan ehtiyotkorlik bilan o‚Äòtish mumkin (belgi va chiziqlarga qarab).", image:null },
            { id:79, text:"Qoidalarga ko‚Äòra yo‚Äòl bo‚Äòyida eshikni ochishdan oldin‚Ä¶", choices:["Darhol ochish kerak","Orqadan kelayotganlarni tekshirish kerak","Signal berish kerak","E‚Äôtibor bermaslik mumkin"], correctIndex:1, rationale:"Orqadan kelayotgan velosipedchi/moto va avtomobillar xavfi bor.", image:null },
            { id:80, text:"'To‚Äòxtab turish taqiqlanadi' va 'To‚Äòxtash taqiqlanadi' farqi?", choices:["Farqi yo‚Äòq","Birinchisi turib qolishni, ikkinchisi hatto qisqa to‚Äòxtashni ham taqiqlaydi","Aksi","Ikkalasi ham faqat yuk mashinalariga"], correctIndex:1, rationale:"'To‚Äòxtash taqiqlanadi' ‚Äî umuman to‚Äòxtash ham mumkin emas.", image:null },
            { id:81, text:"Svetafor yashil, ammo yo‚Äòlni kesib o‚Äòtayotgan piyoda bor‚Ä¶", choices:["Baribir o‚Äòtib ketish","Piyodaga yo‚Äòl berish","Signal berib o‚Äòtish","Tezlikni oshirish"], correctIndex:1, rationale:"Piyodalarga ustuvorlik beriladi.", image:null },
            { id:82, text:"'Yuqori tezlikda shamol ta‚Äôsiri' belgisi nimani anglatadi?", choices:["Yomg‚Äòir bor","Shamol kuchli bo‚Äòlishi mumkin, ehtiyot bo‚Äòling","Muz bor","Tuman bor"], correctIndex:1, rationale:"Kuchli shamolda boshqaruv barqarorligi yomonlashadi.", image:null },
            { id:83, text:"Yoqilg‚Äòi quyish shoxobchasida telefon va sigaret‚Ä¶", choices:["Ruxsat","Telefon ruxsat, sigaret yo‚Äòq","Ikalasi ham taqiqlanadi","Faqat sigaret ruxsat"], correctIndex:2, rationale:"Yonuvchan muhit ‚Äî uchqun xavfi.", image:null },
            { id:84, text:"'Yo‚Äòl chetidagi ishlar' belgisi ko‚Äòrsatilsa‚Ä¶", choices:["Hech narsa","Tezlikni moslab ehtiyotkorlik bilan o‚Äòtish","Tezlikni oshirish","Signal berish"], correctIndex:1, rationale:"Ishchilar va texnika bor ‚Äî ehtiyot choralari zarur.", image:null },
            { id:85, text:"Suv toshgan yo‚Äòlakchadan o‚Äòtishda‚Ä¶", choices:["Tezlikni oshirish","Past tezlikda barqaror gaz va past uzatma","Dvigatelni o‚Äòchirib qo‚Äòyish","Keskin tormozlash"], correctIndex:1, rationale:"Suv zarbidan saqlanish va boshqaruvni yo‚Äòqotmaslik uchun.", image:null },
            { id:86, text:"G‚Äòildirak portlasa birinchi amal?", choices:["Keskin tormoz","Rulni mahkam ushlab, sekinlashtirish va yo‚Äòl chetiga xavfsiz to‚Äòxtash","Gaz berish","Signallash"], correctIndex:1, rationale:"Barqarorlikni saqlab, silliq sekinlashish kerak.", image:null },
            { id:87, text:"'Velosipedchilar bilan umumiy yo‚Äòl' belgisi nimani anglatadi?", choices:["Velosiped taqiqlangan","Avtomobil ustun","Velosipedchilar bilan birga harakat, ehtiyotkorlik","Piyodalar ustun"], correctIndex:2, rationale:"Birga foydalaniladigan yo‚Äòlda ehtiyotkorlik zarur.", image:null },
            { id:88, text:"Yo‚Äòl-transport hodisasi guvohi bo‚Äòlsangiz‚Ä¶", choices:["E‚Äôtibor bermang","Xavfsizlikni ta‚Äôminlab tez yordamga xabar bering","Suratga oling xolos","Uzoqdan kuzating"], correctIndex:1, rationale:"Tez yordamga xabar berish va xavfsizlikni ta‚Äôminlash fuqarolik burchi.", image:null },
            { id:89, text:"'Tirqishli (qirqilgan) chiziq' nimani bildiradi?", choices:["Kesib o‚Äòtish mumkin","Hech qachon kesib bo‚Äòlmaydi","Faqat tunda kesiladi","Faqat chapga kesiladi"], correctIndex:0, rationale:"Qirqilgan chiziq ‚Äî manevrga ruxsat (xavfsiz bo‚Äòlsa).", image:null },
            { id:90, text:"Avtomobilning 'o‚Äòlik zona'si nimani anglatadi?", choices:["Hech narsa","Oynalarda ko‚Äòrinmaydigan sohalar","Radiator zonasi","Yorug‚Äòlik zonasi"], correctIndex:1, rationale:"Yon/ortda oynalarda ko‚Äòrinmaydigan joylar ‚Äî yelkadan qarash zarur.", image:null },
            { id:91, text:"Qachon avtotransportda qishki shinalar foydali?", choices:["Faqat yozda","Sirpanchiq/low harorat sharoitida","Har doim zararli","Faqat qumli yo‚Äòlda"], correctIndex:1, rationale:"Past harorat va sirpanchiq yuzada qishki shina samaraliroq.", image:null },
            { id:92, text:"'Turar-joy zonasi' belgisida haydash xususiyati?", choices:["Tezlik cheklanmaydi","Piyodalarga maksimal ustuvorlik va sekin harakat","Faqat yuk mashinalari","Velosipedlar taqiqlanadi"], correctIndex:1, rationale:"Turar-joy zonalarida piyodalar ustuvor, tezlik keskin cheklangan.", image:null },
            { id:93, text:"Avariya joyida transportni surish kerak bo‚Äòlsa‚Ä¶", choices:["Bir o‚Äòzingiz qilasiz","Xavfsizlikni ta‚Äôminlab, belgilar va uchburchak qo‚Äòyib, keyin suriladi","Darhol suriladi","Hech narsa"], correctIndex:1, rationale:"Avval ogohlantirish va xavfsizlik.", image:null },
            { id:94, text:"'Qiyalik pastga' belgisi nimani bildiradi?", choices:["Ko‚Äòtarilish","Tik pastga tushish bor","Tirbandlik","Yomg‚Äòir"], correctIndex:1, rationale:"Tormoz tizimini nazorat qilish zarurligini bildiradi.", image:null },
            { id:95, text:"Orqa tumanga qarshi chiroqlarni qachon o‚Äòchirish kerak?", choices:["Hech qachon","Ko‚Äòrinish yaxshilanganda","Faqat tunda","Faqat yomg‚Äòirda"], correctIndex:1, rationale:"Boshqalarning ko‚Äòzini qamashtirmaslik uchun ko‚Äòrinish yaxshilanganda o‚Äòchiriladi.", image:null },
            { id:96, text:"'Ajratilgan jamoat transport yo‚Äòlagi'ga kirish‚Ä¶", choices:["Har doim ruxsat","Hech qachon ruxsat yo‚Äòq","Belgilar ruxsat bersa ayrim soatlarda mumkin","Faqat tungi vaqtda"], correctIndex:2, rationale:"Mahalliy belgi/qoida asosida vaqtinchalik ruxsat bo‚Äòlishi mumkin.", image:null },
            { id:97, text:"Chapga burilishda yo‚Äòl o‚Äòrtasida kutish kerak bo‚Äòlsa‚Ä¶", choices:["To‚Äòliq qarama-qarshi yo‚Äòlga chiqib turish","Markazga yaqin, lekin chiziqni kesmasdan turish","O‚Äòng chetda turish","Hech narsa"], correctIndex:1, rationale:"Markazga yaqinlashib, chiziqlarni buzmasdan navbat kutish xavfsiz.", image:null },
            { id:98, text:"'Hayvonlar kesib o‚Äòtishi mumkin' belgisi nimani anglatadi?", choices:["Hech narsa","Ov qilish mumkin","Yo‚Äòlda hayvonlar paydo bo‚Äòlishi mumkin, ehtiyot bo‚Äòling","Piyodalar ustuvor"], correctIndex:2, rationale:"Hayvonlar to‚Äòsatdan chiqishi mumkin ‚Äî tezlikni moslang.", image:null },
            { id:99, text:"Avtomobilni orqaga harakatga keltirishdan avval‚Ä¶", choices:["Faqat oynaga qarash yetarli","Atrofni yelkadan qarab tekshirish va ehtiyotkorlik","Signal berish kifoya","Tez harakat"], correctIndex:1, rationale:"O‚Äòlik zonalarni yelkadan qarab tekshirish kerak.", image:null },
            { id:100, text:"Tunda qarama-qarshi yo‚Äònalishda faralar balandligi noto‚Äòg‚Äòri bo‚Äòlsa‚Ä¶", choices:["Hech narsa","Boshqalarni ko‚Äòr bo‚Äòlishi mumkin ‚Äî sozlash zarur","Uzoq chiroq yoqish","Ichki chiroqlarni yoqish"], correctIndex:1, rationale:"Noto‚Äòg‚Äòri sozlangan faralar boshqalarni qamashtiradi ‚Äî xavf tug‚Äòdiradi.", image:null },
        ];



        let QUESTIONS = [...originalQuestions]; 
        let current = 0;
        let answers = [];
        let mistakes = 0;
        let finished = false;
        let timerInterval = null;
        let timeLeft = 30 * 60;   // 30 daqiqa
        let timeUsed = 0;

        // --- Mantiqiy Funksiyalar ---
        function show(el){el.classList.remove('hidden')}
        function hide(el){el.classList.add('hidden')}

        function updateProgress(){ 
            barEl.style.width = Math.round(((current+1)/QUESTIONS.length)*100)+'%'; 
            qIndexEl.textContent = String(current+1);
            
            const statusText = finished ? 'Yakunlandi' : `${current+1} / 20 savol`;
            document.getElementById('quizStatusChip').innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8h.01M11 12h2v4h-2z"/></svg> ${statusText}`;
        }
        
        function switchScreen(targetId, targetIndex = 0) {
            const currentScreen = document.getElementById(currentActiveScreenId);
            const targetScreen = document.getElementById(targetId);
            const targetScreenIndex = parseInt(targetScreen.dataset.index);
            
            if (currentScreen === targetScreen) return; 

            currentScreen.classList.remove('active');
            
            if (targetScreenIndex > currentScreenIndex) {
                 currentScreen.classList.add('exit-left');
                 currentScreen.style.transform = 'translateX(-100%)'; 
                 targetScreen.style.transform = 'translateX(100%)'; 
            } else {
                 currentScreen.style.transform = 'translateX(100%)'; 
                 currentScreen.classList.remove('exit-left');
                 targetScreen.style.transform = 'translateX(-100%)'; 
            }
            currentScreen.style.position = 'absolute';
                        
            setTimeout(() => {
                targetScreen.classList.remove('exit-left');
                currentScreen.classList.remove('exit-left');

                targetScreen.classList.add('active');
                targetScreen.style.position = 'relative';

                if (targetId === 'quiz-screen' && !finished) {
                    renderQuestion();
                }
            }, 200);

            
            currentActiveScreenId = targetId;
            currentScreenIndex = targetScreenIndex;

            navLinks.forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link[data-target="${targetId}"]`);
            if (activeLink) activeLink.classList.add('active');

            if (targetId === 'account-screen') {
                loadHistory();
            } else if (targetId === 'start-screen') {
                displayLastResultSummary();
                updateProgress(); 
            }
        }

        // --- Testni Boshlash va Savolni Renderlash ---
        function resetAll(){ 
            current = 0; 
            answers = []; 
            mistakes = 0; 
            finished = false; 

            mistakesEl.textContent = '0'; 
            reviewListContainer.classList.add('hidden');

            // ‚úÖ 100 savoldan rand 20 ta olish
            QUESTIONS = [...originalQuestions]
                .sort(() => Math.random() - 0.5)
                .slice(0, 20);

            // ‚úÖ TIMER qayta ishga tushadi
            clearInterval(timerInterval);
            timeLeft = 30 * 60;   // 30 daqiqa
            timeUsed = 0;
            startTimer();

            updateProgress(); 
            renderQuestion(); 
            switchScreen('quiz-screen', 1); 
        }

        function startTimer(){
            const timerEl = document.getElementById('timer');
            timerInterval = setInterval(()=>{
                timeLeft--;
                timeUsed++;

                if (timerEl) {
                    const m = String(Math.floor(timeLeft/60)).padStart(2,'0');
                    const s = String(timeLeft%60).padStart(2,'0');
                    timerEl.textContent = `${m}:${s}`;
                }

                if(timeLeft <= 0){
                    clearInterval(timerInterval);
                    onFinish(true, true); 
                }

            },1000);
        }



        function renderQuestion(){
            choicesEl.style.pointerEvents = 'auto';
            const q = QUESTIONS[current];
            qTextEl.textContent = q.text;
            rationaleEl.style.display = 'none';
            
            choicesEl.innerHTML = '';
            
            q.choices.forEach((txt, i)=>{
                const btn = document.createElement('button');
                btn.className = 'choice';
                btn.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px">
                        <div class="letter" style="display:grid;place-items:center;width:36px;height:36px;border-radius:12px;font-weight:800; color:var(--text); border:1px solid var(--glass-border);">${String.fromCharCode(65+i)}</div>
                        <div>${txt}</div>
                    </div>
                    <div class="muted check-icon" style="opacity:.8; display:none;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>
                    </div>`;
                btn.addEventListener('click',()=>handleAnswer(i, btn));
                choicesEl.appendChild(btn);
            });
        }

        function handleAnswer(choiceIndex){
            if (finished) return;

            const q = QUESTIONS[current];
            const correct = choiceIndex === q.correctIndex;

            // Variantlarni bloklash
            choicesEl.querySelectorAll('.choice').forEach(b => {
                b.style.pointerEvents = 'none';
            });

            answers.push({
                qId: q.id,
                qText: q.text,
                selected: q.choices[choiceIndex],
                correct: q.choices[q.correctIndex],
                isCorrect: correct,
                rationale: q.rationale || 'Izoh berilmagan.',
                image: q.image || null
            });

            const nodes = Array.from(choicesEl.children);
            nodes.forEach((n, i) => {
                const checkIcon = n.querySelector('.check-icon');
                if (i === q.correctIndex) {
                    n.classList.add('correct');
                    checkIcon.style.display = 'block';
                }
                if (i === choiceIndex && !correct) {
                    n.classList.add('wrong');
                    checkIcon.style.display = 'block';
                    if ("vibrate" in navigator) navigator.vibrate(200);
                }
            });

            rationaleEl.textContent = q.rationale || 'Izoh topilmadi.';
            rationaleEl.style.display = 'block';

            if (!correct) {
                mistakes++;
                mistakesEl.textContent = String(mistakes);
            }

            // ‚úÖ Keyingi savolga xavfsiz o‚Äòtish
            setTimeout(() => {
                const next = current + 1;

                if (mistakes >= MAX_MISTAKES) {
                    onFinish(true);
                    return;
                }

                if (next >= QUESTIONS.length) {
                    onFinish(false);
                    return;
                }

                current = next;
                updateProgress();
                renderQuestion();

            }, 1000);
        }



        function onFinish(failedByMistakes){
            finished = true; 
            updateProgress(); 
            
            const correctCount = answers.filter(a => a.isCorrect).length;
            const finalPassed = correctCount >= PASS_SCORE && !failedByMistakes;

            saveHistory(correctCount, mistakes, QUESTIONS.length, !finalPassed, answers);

            const finishStatusEl = document.getElementById('finishStatus');
            const scoreEl = document.getElementById('score');
            const finishTextEl = document.getElementById('finishText');

            if(finalPassed){
                finishStatusEl.innerHTML = `<span style="color:var(--success)">üèÜ</span> Tabriklaymiz! Imtihondan o'tdingiz!`;
                finishStatusEl.style.background = 'rgba(16,185,129,.14)';
                scoreEl.textContent = `Natija: ${correctCount} / ${QUESTIONS.length}`;
                finishTextEl.textContent = 'Ajoyib natija! Haydash ko\'nikmalarida ham shu kabi ustunlik tilaymiz.';
            } else if (failedByMistakes) {
                finishStatusEl.innerHTML = `<span style="color:var(--danger)">‚úñ</span> Afsus! Xato limiti (${MAX_MISTAKES}) oshirildi.`;
                finishStatusEl.style.background = 'rgba(239,68,68,.14)';
                scoreEl.textContent = `Natija: ${correctCount} / ${QUESTIONS.length}`;
                finishTextEl.textContent = `${mistakes} ta xatoga yetildi. Keyingi urinishda qoidalarni yanada puxta o'rganing!`;
            } else { // 17 tadan kam to'g'ri, lekin xato limiti oshirilmagan
                finishStatusEl.innerHTML = `<span style="color:var(--danger)">‚úñ</span> Afsus! Testdan o'ta olmadingiz.`;
                finishStatusEl.style.background = 'rgba(239,68,68,.14)';
                scoreEl.textContent = `Natija: ${correctCount} / ${QUESTIONS.length}`;
                finishTextEl.textContent = `Imtihon shartini bajarish uchun kamida ${PASS_SCORE} ta to'g'ri javob kerak edi. Yaxshi tayyorlaning.`;
            }
            
            reviewList.innerHTML = ''; 
            switchScreen('finish-screen', 2);
        }
        
        // --- History Mantiqi ---
        function getHistory() {
            try { 
                const data = localStorage.getItem('avtoMaktabHistory');
                return JSON.parse(data) || []; 
            } catch(e) { 
                return []; 
            }
        }

        function saveHistory(correct, wrong, total, failed, details) {
            const history = getHistory();
            const passed = correct >= PASS_SCORE && wrong < MAX_MISTAKES;

            // ‚úÖ vaqtni formatlash
            const minutes = Math.floor(timeUsed / 60);
            const seconds = timeUsed % 60;
            const timeFormatted = `${minutes}m ${seconds}s`;

            history.unshift({
                date: new Date().toLocaleString('uz-UZ', { 
                    year: 'numeric', month: '2-digit', day: '2-digit', 
                    hour: '2-digit', minute: '2-digit' 
                }),
                correct: correct,
                wrong: wrong,
                total: total,
                passed: passed,
                time: timeFormatted,   // ‚úÖ qo‚Äòshildi!
                details: details
            });

            try {
                localStorage.setItem('avtoMaktabHistory', JSON.stringify(history.slice(0, 20)));
            } catch(e){}
        }


        function clearHistory() {
            if (confirm("Haqiqatdan ham barcha test natijalarini tozalashni xohlaysizmi? Bu amalni qaytarib bo'lmaydi.")) {
                try {
                    localStorage.removeItem('avtoMaktabHistory');
                    loadHistory(); 
                    displayLastResultSummary(); 
                    alert("Testlar tarixi muvaffaqiyatli tozalandi.");
                } catch(e) {
                    alert("Tarixni tozalashda xato yuz berdi.");
                }
            }
        }


        function loadHistory() {
            const history = getHistory();
            historyList.innerHTML = '';

            if (history.length === 0) {
                historyList.innerHTML = '<p class="muted" style="text-align:center; margin-top:20px;">Siz hali test ishlamadingiz.</p>';
                return;
            }

            history.forEach((item, index) => {
                const status = item.passed ? 'üèÜ O ªtdi' : (item.wrong >= MAX_MISTAKES ? '‚ùå Xato Limiti' : '‚ùå O ªta Ol.mas');
                const statusColor = item.passed ? 'var(--success)' : 'var(--danger)';

                const itemEl = document.createElement('div');
                itemEl.className = 'history-item card p-16';
                itemEl.dataset.index = index;

                itemEl.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:700;">${item.date}</span>
                        <span style="color:${statusColor}; font-weight:700;">${status}</span>
                    </div>
                        <p class="muted" style="font-size:14px; margin-top:5px;">
                            To ªg ªri: <span style="color:var(--success)">${item.correct}</span> /
                            Xato: <span style="color:var(--danger)">${item.wrong}</span> /
                            Jami: ${item.total} savol<br>
                            ‚è± Vaqt: <b>${item.time}</b> daq. ‚úÖ
                        </p>

                    <div id="detail-${index}" class="history-detail-review hidden"></div>
                `;

                itemEl.addEventListener('click', () => toggleHistoryDetails(item, index));
                historyList.appendChild(itemEl);
            });
        }
        
        function toggleHistoryDetails(item, index) {
            const detailEl = document.getElementById(`detail-${index}`);
            const isHidden = detailEl.classList.contains('hidden');
            
            document.querySelectorAll('.history-detail-review').forEach(el => el.classList.add('hidden'));

            if (isHidden) {
                detailEl.classList.remove('hidden');
                detailEl.innerHTML = item.details.map((d, i) => `
                    <div class="history-detail-item" style="margin-top: 8px; display: flex; align-items: flex-start; gap: 8px; color: ${d.isCorrect ? 'var(--success)' : 'var(--danger)'};">
                        <span style="min-width: 20px;">${d.isCorrect ? '‚úÖ' : '‚ùå'}</span>
                        <div>
                            <span style="font-weight:600; color:var(--text);">${i+1}. ${d.qText}</span>
                            <div class="muted" style="font-size:12px;">
                                Javobingiz: <span style="font-weight:bold; color:var(--danger)">${d.selected}</span> 
                                ${!d.isCorrect ? `<span style="margin-left:8px; color:var(--success)">(Tog'risi: ${d.correct})</span>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                detailEl.classList.add('hidden');
            }
        }
        
        function displayLastResultSummary() {
            const history = getHistory();
            if (history.length === 0) {
                 hide(lastResultSummary);
                 return;
            }
            const lastTest = history[0];
            let statusText = lastTest.passed ? "üèÜ Muvaffaqiyatli o'tdingiz!" : "‚ùå O'ta olmadingiz.";
            
            summaryText.innerHTML = `${statusText} | Natija: <span style="color:var(--success)">${lastTest.correct}</span> to'g'ri, <span style="color:var(--danger)">${lastTest.wrong}</span> xato.`;
            show(lastResultSummary);
        }


        // --- Eventlar ---
        document.getElementById('startBtn').addEventListener('click', resetAll);
        document.getElementById('restart').addEventListener('click', ()=>{ switchScreen('start-screen', 0); });
        document.getElementById('goToHistoryBtn').addEventListener('click', ()=>{ switchScreen('account-screen', 3); });
        clearHistoryBtn.addEventListener('click', clearHistory);
        
        document.getElementById('restartMid').addEventListener('click', ()=>{
             if(confirm("Testni noldan boshlashni xohlaysizmi? Hozirgi natija saqlanmaydi.")) {
                resetAll();
             }
        });
        
        document.getElementById('goToReview').addEventListener('click', ()=>{ 
            reviewListContainer.classList.toggle('hidden');
            if(!reviewListContainer.classList.contains('hidden') && reviewList.innerHTML === '') {
                reviewList.innerHTML = answers.map((a, i) => `
                    <div class="card p-16" style="border-color:${a.isCorrect ? 'rgba(16,185,129,.5)' : 'rgba(239,68,68,.5)'}; background:${a.isCorrect ? 'rgba(16,185,129,.10)' : 'rgba(239,68,68,.10)'}">
                        <div style="font-weight:700; color:var(--text); margin-bottom:4px;">
                            ${i+1}. ${a.qText}
                        </div>
                        <div class="muted" style="font-size:13px; line-height:1.4;">
                            Sizning javobingiz: <span style="font-weight:bold; color:var(--danger)">${a.selected}</span><br>
                            To'g'ri javob: <span style="font-weight:bold; color:var(--success)">${a.correct}</span>
                            <div class="rationale" style="margin-top:8px; border:1px dashed var(--glass-border);padding:12px;border-radius:12px;font-size:14px;background:rgba(255,255,255,.05)">${a.rationale}</div>
                        </div>
                    </div>
                `).join('');
            }
        });
        
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.dataset.target;
                const targetIndex = parseInt(link.dataset.index);
                switchScreen(targetId, targetIndex);
            });
        });

        // --- Tema funksiyasi (Tun/Tong rejimi) ---
        function setTheme(mode){
          if(mode==='light'){
            root.classList.add('light');
            themeDot.style.transform = 'translateX(38px)';
            lightBtn.style.color = 'var(--active-nav-color)';
            darkBtn.style.color = 'var(--muted)';
          } else {
            root.classList.remove('light');
            themeDot.style.transform = 'translateX(0)';
            darkBtn.style.color = 'var(--active-nav-color)';
            lightBtn.style.color = 'var(--muted)';
          }
          try{localStorage.setItem('theme2', mode);}catch(e){}
        }

        const initialTheme = (function(){
          try{ return localStorage.getItem('theme2') || (matchMedia('(prefers-color-scheme: light)').matches ? 'light':'dark'); }catch(e){return 'dark'}
        })();
        setTheme(initialTheme);
        
        lightBtn.addEventListener('click',()=>setTheme('light'));
        darkBtn.addEventListener('click',()=>setTheme('dark'));
        
        // --- Boshlang'ich Holatni Sozlash ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('year').textContent = new Date().getFullYear();
            const startScreen = document.getElementById('start-screen');
            startScreen.classList.add('active');
            startScreen.style.position = 'relative';
            startScreen.style.transform = 'translateX(0)';
            currentActiveScreenId = 'start-screen';
            currentScreenIndex = 0;

            const qTotalEl = document.getElementById('qTotal');
            if (qTotalEl) qTotalEl.textContent = String(TOTAL_QUESTIONS);
            displayLastResultSummary();
        });
        
    </script>
</body>
</html>
